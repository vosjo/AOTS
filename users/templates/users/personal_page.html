{% extends "landing.html" %}

{% load static %}

{% block head %}
    <script type="text/javascript" src="{% static 'js/profile_page.js' %}"></script>
    <title>Your Profile</title>
    <link href="{% static 'css/userpage.css' %}" rel="stylesheet" type="text/css">
{% endblock %}

{% block headertitle %} Your Profile {% endblock %}

{% block navigation %}
    <a href="/stars/stars"> INDEX </a>
    <strong>|</strong>
    <a href="/stars/tags" class="active"> Tags </a>
{% endblock %}
{% block content %}
<div class="infocontainer">
    <div class="userbox">
        {% if this_user.profile_picture %}
            <div class="profilepic-container">
                <img class="profilepic" src="{{ this_user.profile_picture.url }}" alt="Profile pic">
                <a onclick="return openChangeProfilePicWindow()" class="edit-button"><i class="material-icons button edit" title="Edit">edit</i></a>
            </div>
        {% else %}
            <div class="profilepic-container">
                <img class="profilepic" src="{% static 'images/default_user.png' %}" alt="Profile pic">
                <a onclick="return openChangeProfilePicWindow()" class="edit-button"><i class="material-icons button edit" title="Edit">edit</i></a>
            </div>
        {% endif %}
        <div class="userinfo">
            <h2 class="username">{{ this_user.username }}</h2>
            <h3 class="fullname">{{ this_user.first_name }} {{ this_user.last_name }}</h3>
            <h4 class="affiliation">{{ this_user.note }}</h4>
        </div>
    </div>
    <div class="api_key_container">
        <h3 class="keylocker_headline">API key locker</h3>
        <p class="api-key-text"> Your API key is shown below, if you have just generated one. Please note that you can not see your API key again after leaving this page, for security reasons. Should you have forgotten your key, please generate a new one with the button below.</p>
        {% if secret_key %}
            <p class="api-key">Your public API key: {{ public_key }}<br>Your secret API key: {{ secret_key }} Treat this like a password, you will not be able to display this key again.</p>
        {% elif this_user.api_secret %}

            <p class="api-key">Your public API key: {{ public_key }}<br>You can not display your secret API key anymore. In case you have lost it, please generate a new one.</p>
        {% else %}
            <p class="api-key">You have not generated an API key pair yet! If you need one, please generate it using the button.</p>
        {% endif %}
        <form action="{% url "users:personal_page" %}" method="post"
                                      enctype="multipart/form-data" class="" id="gen-api-key-form">
                                    {% csrf_token %}
            <input type="submit" class="generate-api-key-button" name="apikeygen" value="Generate new API key"/>
        </form>
    </div>
</div>
<div id="changepropic" title="Change Profile Pic" hidden>
    <form action="{% url "users:personal_page" %}" method="post"
                                  enctype="multipart/form-data" class="" id="change-propic-form">
                                {% csrf_token %}
        {% if form.non_field_errors %}
            <p>{{ form.non_field_errors }}</p>
        {% endif %}

        <p>
            {{ form.newpic.errors }}
            {{ form.newpic }}
        </p>

        <input type="submit" class="upload-button" name="chngpic" value="Change Profile Picture"/>
    </form>
</div>
{% endblock %}
